# Origin - 工作流程指南

## 三种编辑方式

Origin 提供三种编辑应用的方式，它们完全同步到统一的 DSL 层：

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 可视化编辑器 │ ←→ │   USD DSL   │ ←→ │   AI 助手   │
│  (设计师)   │     │  (核心层)   │     │  (任何人)   │
└─────────────┘     └─────────────┘     └─────────────┘
```

---

## 方式一：可视化编辑

### 适用场景
- 设计师创建 UI
- 产品经理原型设计
- 快速布局调整

### 基础工作流

```
1. 创建项目
   ├─ 项目名称
   ├─ 目标框架 (Flutter/React Native)
   └─ 平台选择 (iOS/Android/Web)

2. 创建页面
   ├─ 新建 Screen
   ├─ 设置路由
   └─ 配置页面属性

3. 设计界面
   ├─ 从组件库拖拽组件
   ├─ 在画布上调整位置和尺寸
   ├─ 在属性面板配置样式
   └─ 在图层面板管理层次

4. 添加语义 (可选)
   ├─ 在状态面板定义变量
   ├─ 在数据面板绑定 API
   └─ 在交互面板配置行为

5. 实时预览
   ├─ 切换到预览模式
   ├─ 测试交互流程
   └─ 调整细节

6. 生成代码
   ├─ 选择目标框架
   ├─ 配置生成选项
   └─ 导出代码
```

### 可视化表达语义

| 语义 | 可视化表示 |
|------|-----------|
| **状态** | 右侧面板 "状态" 标签页 |
| **数据绑定** | 属性面板的绑定图标 🔗 |
| **交互** | 右侧面板 "交互" 标签页 |
| **验证** | 输入框边缘颜色提示 |
| **导航** | 页面间连线表示 |

---

## 方式二：DSL 编辑

### 适用场景
- 开发者精确控制
- 复杂逻辑定义
- 批量修改

### DSL 编辑器界面

```
┌───────────────────────────────────────────────────────────┐
│  USD Editor                              [Validate] [Sync] │
├───────────────────────────────────────────────────────────┤
│  1   @version("2.0")                                      │
│  2   @description("登录页面")                              │
│  3                                                          │
│  4   Screen LoginScreen {                                 │
│  5       Route {                                          │
│  6           path: "/login"                               │
│  7           name: "login"                                │
│  8       }                                                │
│  9                                                          │
│ 10       State {                                          │
│ 11           username: String                             │
│ 12           password: String                             │
│ 13           isLoading: Boolean = false                   │
│ 14       }                                                │
│ 15                                                         │
│ 16       Layout {                                         │
│ 17           Container { direction: column ... }          │
│ 18       }                                                │
│ 19   }                                                     │
├───────────────────────────────────────────────────────────┤
│  Problems (0) | Output | Terminal                          │
└───────────────────────────────────────────────────────────┘
```

### DSL 编辑特性

| 特性 | 说明 |
|------|------|
| **语法高亮** | 关键字、类型、字符串 |
| **智能提示** | 组件、属性、状态 |
| **实时校验** | 语法、类型、引用 |
| **代码跳转** | 跳转到定义/引用 |
| **重构** | 重命名、提取 |
| **格式化** | 自动格式化代码 |

### 典型工作流

```dsl
// 1. 定义页面结构
Screen LoginScreen {
    Route { path: "/login" }

    // 2. 定义状态
    State {
        username: String = ""
        password: String = ""
    }

    // 3. 定义布局
    Layout {
        Container {
            direction: column
            padding: 24

            // 绑定状态
            TextField {
                placeholder: "用户名"
                value: bind username
            }

            Button {
                content: "登录"
                onClick: loginAction
            }
        }
    }

    // 4. 定义交互
    Interaction {
        Action loginAction {
            isLoading = true
            result = await api.auth.login({
                username: username,
                password: password
            })
            if result.isSuccess {
                navigateTo("/home")
            }
            isLoading = false
        }
    }
}
```

---

## 方式三：AI 助手

### 适用场景
- 快速原型设计
- 自然语言描述需求
- 设计建议与优化

### AI 助手界面

```
┌───────────────────────────────────────────────────────────┐
│  🤖 Origin AI                                      [●]    │
├───────────────────────────────────────────────────────────┤
│                                                           │
│  你: 创建一个登录页面，包含用户名、密码输入框和登录按钮      │
│                                                           │
│  🤖: 我来帮你创建。我会生成以下内容：                       │
│                                                           │
│      1. LoginScreen 页面                                  │
│      2. username 和 password 状态                         │
│      3. 登录按钮交互                                      │
│      4. API 调用绑定 (auth.login)                         │
│                                                           │
│      ┌─────────────────────────┐                          │
│      │        [Logo]           │                          │
│      │                         │                          │
│      │  用户名: [_________]     │                          │
│      │  密码:   [_________]     │                          │
│      │                         │                          │
│      │    [    登录    ]       │                          │
│      └─────────────────────────┘                          │
│                                                           │
│  [应用此设计] [继续调整] [查看 DSL]                         │
│                                                           │
├───────────────────────────────────────────────────────────┤
│  输入消息...                                     [发送]   │
└───────────────────────────────────────────────────────────┘
```

### AI 能力

| 能力 | 说明 |
|------|------|
| **意图理解** | 理解自然语言需求 |
| **DSL 生成** | 自动生成 USD DSL |
| **设计建议** | 布局、样式优化 |
| **组件推荐** | 推荐合适的组件 |
| **代码解释** | 解释 DSL 和生成代码 |

### AI 工作流

```
1. 用户输入需求
   "创建一个电商首页，顶部有搜索框，下面是商品网格"

2. AI 分析意图
   ├─ 识别: 首页 + 搜索 + 商品列表
   ├─ 组件: SearchBar + ProductGrid
   ├─ 状态: searchQuery + products
   └─ 布局: Column + Grid

3. 生成 DSL 草稿
   └─ 包含完整结构和语义

4. 可视化预览
   └─ 同步到画布供用户查看

5. 用户确认/调整
   ├─ 直接确认应用
   ├─ 继续对话调整
   └─ 手动在画布/DSL 修改
```

---

## 完整开发流程示例

### 场景：创建一个商品列表页面

#### 方式 A：可视化设计 (设计师)

```
1. 拖拽组件到画布
   ├─ Container (页面容器)
   ├─ SearchBar (搜索框)
   ├─ ProductGrid (商品网格)
   └─ BottomNav (底部导航)

2. 配置属性
   ├─ 间距、颜色、圆角
   ├─ 字体大小、粗细
   └─ 阴影效果

3. 添加语义
   ├─ 状态面板: searchQuery, products
   ├─ 数据面板: 绑定 API /products
   └─ 交互面板: 点击跳转详情页

4. 预览并生成
```

#### 方式 B：DSL 编辑 (开发者)

```dsl
Screen ProductListScreen {
    Route { path: "/products" }

    State {
        searchQuery: String = ""
        products: List<Product> = []
        isLoading: Boolean = true
    }

    Data {
        products: Query<List<Product>> {
            source: api.products.list({
                search: searchQuery.ifNotEmpty
            })
            dependencies: [searchQuery]
        }
    }

    Layout {
        Scaffold {
            body: Column {
                SearchBar {
                    value: bind searchQuery
                }

                ProductGrid {
                    items: Data.products
                    onTap: { product in
                        navigateTo(ProductDetail, {id: product.id})
                    }
                }
            }
        }
    }
}
```

#### 方式 C：AI 助手 (产品经理)

```
你: 我需要一个商品列表页面，要有搜索功能，点击商品能跳到详情页

🤖: 好的，我来帮你创建。我会生成：
    - ProductListScreen 页面
    - 搜索框状态 (searchQuery)
    - 商品列表数据 (products)
    - 商品网格布局
    - 点击跳转交互

[应用此设计]

你: 搜索框能不能改成圆角的？

🤖: 好的，已更新搜索框圆角为 12px

[应用更改]
```

---

## 从设计到代码的完整流程

```
1. 创建项目
   ├─ 项目名称: "MyShop"
   ├─ 框架: Flutter
   └─ 平台: iOS + Android

2. 导入 API (可选)
   ├─ 导入 OpenAPI JSON
   ├─ 选择需要的端点
   └─ 自动生成类型定义

3. 设计界面 (三选一)
   ├─ 可视化: 拖拽设计
   ├─ DSL: 编写代码
   └─ AI: 自然语言描述

4. 添加语义
   ├─ 状态定义
   ├─ 数据绑定
   └─ 交互配置

5. 实时预览
   ├─ 查看渲染效果
   ├─ 测试交互流程
   └─ 调整细节

6. 生成代码
   ├─ 选择生成选项
   ├─ 生成项目文件
   └─ 下载/推送到 Git

7. 后续开发
   ├─ 在 Flutter 项目中继续开发
   ├─ Origin 生成的代码可维护
   └─ 支持增量更新
```

---

## OpenAPI 集成流程

```
1. 导入 OpenAPI
   ├─ URL 导入
   ├─ 文件上传
   └─ 粘贴 JSON/YAML

2. 选择端点
   ├─ 浏览所有端点
   ├─ 选择需要的 API
   └─ 配置参数

3. 绑定到组件
   ├─ 在数据面板选择 API
   ├─ 绑定请求参数到状态
   └─ 配置响应处理

4. 生成调用代码
   ├─ 自动生成网络层
   ├─ 类型定义
   └─ 错误处理
```

---

## 协作工作流

```
1. 创建项目
   └─ 本地创建或从云端克隆

2. 设计开发
   ├─ 设计师: 可视化编辑
   ├─ 开发者: DSL 编辑
   └─ 产品: AI 助手

3. 实时同步
   ├─ 本地: CRDT 自动同步
   └─ 云端: WebSocket 实时推送

4. 代码评审
   ├─ 查看变更历史
   ├─ 添加评论
   └─ 讨论修改

5. 版本管理
   ├─ Git 提交
   ├─ 创建分支
   └─ 合并主分支
```

---

## 最佳实践

### 设计原则

1. **语义优先**：尽可能添加语义信息
2. **组件复用**：创建可复用组件
3. **渐进增强**：从简单开始逐步添加功能
4. **实时预览**：频繁预览确认效果

### 代码生成建议

1. **先设计后生成**：确认设计无误再生成
2. **增量更新**：修改设计后重新生成
3. **保护区域**：手动修改的代码标记保护
4. **版本管理**：每次生成前提交代码

### AI 使用建议

1. **清晰描述**：详细描述需求
2. **迭代优化**：多轮对话调整
3. **确认应用**：确认后再应用到项目
4. **学习 DSL**：通过 AI 学习 DSL 语法
