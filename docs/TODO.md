# Origin - 开发任务清单

## 开发路线图

```
Phase 1: 语义核心 (8 周) → Phase 2: 完整设计体验 (6 周) →
Phase 3: 语义增强 (6 周) → Phase 4: 生成与部署 (4 周)
```

---

## Phase 1: 语义核心 (8 周)

### Week 1-2: USD DSL Parser

**目标**: 实现 USD v2 语法解析器

#### Rust Backend
- [ ] USD v2 语法最终确定
  - [ ] 8 大语义维度语法
  - [ ] 类型系统定义
  - [ ] 表达式语法
- [ ] Pest 语法规则编写
  - [ ] 词法规则
  - [ ] 语法规则
  - [ ] AST 定义
- [ ] Parser 实现
  - [ ] 文档解析
  - [ ] 类型推断
  - [ ] 错误恢复
- [ ] Validator 实现
  - [ ] 类型检查
  - [ ] 引用检查
  - [ ] 循环依赖检测
- [ ] Formatter 实现
  - [ ] 代码格式化
  - [ ] 语法高亮数据

#### 测试
- [ ] 单元测试覆盖 > 80%
- [ ] 金文件测试 (Golden Tests)

---

### Week 3-4: 可视化编辑器基础

**目标**: 实现基础画布和组件渲染

#### React Frontend
- [ ] 画布引擎初始化 (Fabric.js)
  - [ ] 画布创建与配置
  - [ ] 坐标系统
  - [ ] 视口管理 (缩放/平移)
- [ ] 基础图形绘制
  - [ ] Container/Frame
  - [ ] Text
  - [ ] Rectangle
  - [ ] Image
- [ ] 组件选择与操作
  - [ ] 单选/多选
  - [ ] 移动/缩放/旋转
  - [ ] 复制/粘贴/删除
- [ ] 属性面板
  - [ ] 位置和尺寸
  - [ ] 填充和描边
  - [ ] 文本属性

#### Tauri Commands
- [ ] 文档 CRUD
- [ ] 组件操作
- [ ] 样式更新

---

### Week 5-6: 双向同步机制

**目标**: 实现画布与 DSL 的双向实时同步

#### 同步引擎
- [ ] CRDT 集成 (Yjs)
  - [ ] 文档类型定义
  - [ ] Delta 操作
  - [ ] 撤销/重做
- [ ] Canvas ↔ DSL 同步
  - [ ] Canvas → DSL 转换
  - [ ] DSL → Canvas 渲染
  - [ ] 增量更新优化
- [ ] 冲突解决
  - [ ] 本地冲突
  - [ ] 远程冲突 (未来)
- [ ] 离线支持
  - [ ] 本地存储
  - [ ] 自动同步

#### DSL 编辑器
- [ ] Monaco 集成
  - [ ] 语法高亮
  - [ ] 智能提示
  - [ ] 错误标记
- [ ] 实时校验
  - [ ] 语法错误
  - [ ] 类型错误
  - [ ] 引用错误

---

### Week 7-8: Flutter 代码生成器 MVP

**目标**: 生成可运行的 Flutter 代码

#### 模板系统
- [ ] Handlebars 模板
  - [ ] Screen 模板
  - [ ] Component 模板
  - [ ] 状态管理模板
- [ ] 生成器实现
  - [ ] 路由生成
  - [ ] 状态管理 (Riverpod)
  - [ ] 组件 Widget
- [ ] 项目结构生成
  - [ ] pubspec.yaml
  - [ ] 目录组织
  - [ ] 入口文件

#### 代码质量
- [ ] 符合 Flutter 最佳实践
- [ ] 可读性优化
- [ ] 注释生成

---

## Phase 2: 完整设计体验 (6 周)

### Week 9-10: 高级设计功能

- [ ] 矢量编辑
  - [ ] 路径绘制
  - [ ] 贝塞尔曲线
  - [ ] SVG 导入
- [ ] 高级样式
  - [ ] 渐变
  - [ ] 阴影
  - [ ] 模糊
- [ ] 自动布局
  - [ ] Flex 布局
  - [ ] Grid 布局
  - [ ] 约束系统

### Week 11-12: 组件系统

- [ ] 组件定义
  - [ ] 创建组件
  - [ ] Props 定义
  - [ ] 插槽系统
- [ ] 组件实例
  - [ ] 实例化
  - [ ] 属性覆盖
  - [ ] 嵌套组件
- [ ] 组件库
  - [ ] 内置组件库
  - [ ] 自定义组件
  - [ ] 组件搜索

### Week 13-14: 协作与交付

- [ ] 多人协作 (云端)
  - [ ] WebSocket 同步
  - [ ] 光标同步
  - [ ] 冲突解决
- [ ] 评论系统
  - [ ] 添加评论
  - [ ] 回复讨论
- [ ] 导出功能
  - [ ] PNG/SVG/PDF
  - [ ] DSL 导出
  - [ ] 代码导出

---

## Phase 3: 语义增强 (6 周)

### Week 15-16: 状态与数据

- [ ] 状态面板
  - [ ] 状态变量编辑
  - [ ] 类型选择
  - [ ] 默认值设置
- [ ] 数据绑定
  - [ ] 属性绑定
  - [ ] 双向绑定
  - [ ] 计算属性
- [ ] API 集成
  - [ ] OpenAPI 导入
  - [ ] 类型生成
  - [ ] 绑定配置

### Week 17-18: 交互设计

- [ ] 交互流程图
  - [ ] 节点编辑器
  - [ ] 连线配置
  - [ ] 事件定义
- [ ] 手势配置
  - [ ] 点击/长按
  - [ ] 滑动/拖拽
  - [ ] 缩放/旋转
- [ ] 动画时间线
  - [ ] 关键帧
  - [ ] 缓动函数
  - [ ] 过渡效果

### Week 19-20: AI 集成 (前端)

- [ ] AI 服务接口
  - [ ] OpenAI SDK 集成
  - [ ] Anthropic SDK 集成
  - [ ] Ollama SDK (本地 LLM)
- [ ] AI 配置管理
  - [ ] Provider 选择
  - [ ] API Key 存储 (加密)
  - [ ] Model 选择
  - [ ] 自定义 Endpoint
- [ ] Prompt 模板系统
  - [ ] DSL 生成模板
  - [ ] 建议生成模板
  - [ ] 代码解释模板
- [ ] AI 助手 UI
  - [ ] 聊天面板
  - [ ] 建议预览
  - [ ] 确认应用

---

## Phase 4: 生成与部署 (4 周)

### Week 21-22: 代码生成优化

- [ ] Flutter 生成器完善
  - [ ] 导航生成 (go_router)
  - [ ] API 客户端 (dio)
  - [ ] 本地存储
- [ ] React Native 生成器
  - [ ] 基础生成器
  - [ ] React Navigation
  - [ ] TanStack Query
- [ ] 代码质量
  - [ ] 保护区域 (手动修改)
  - [ ] 增量生成
  - [ ] 代码格式化

### Week 23-24: 部署与集成

- [ ] CI/CD 生成
  - [ ] GitHub Actions
  - [ ] GitLab CI
  - [ ] Docker 配置
- [ ] Git 集成
  - [ ] 代码推送
  - [ ] PR 创建
  - [ ] 版本管理
- [ ] 一键部署
  - [ ] Firebase
  - [ ] AWS
  - [ ] 自定义服务器

---

## 未来功能

- [ ] SwiftUI 生成器
- [ ] 小程序生成器
- [ ] 插件系统
- [ ] 云端协作服务
- [ ] 企业版功能

---

## 当前 Sprint

### Sprint 1: 项目初始化 + 基础画布

**目标**: 能够打开编辑器，绘制基本图形

- [ ] Tauri 项目初始化
- [ ] React 项目初始化
- [ ] USD DSL 基础结构定义
- [ ] 画布基础 (Fabric.js)
- [ ] 基础图形绘制 (Container, Text)
- [ ] 属性面板 (位置、尺寸)
- [ ] 本地存储 (SQLite)
- [ ] 基本 DSL 序列化

### Sprint 2: DSL Parser + 双向同步

**目标**: 能够解析 DSL 并同步到画布

- [ ] Pest 语法规则
- [ ] Parser 实现
- [ ] AST 定义
- [ ] Canvas → DSL 转换
- [ ] DSL → Canvas 渲染
- [ ] 撤销/重做

### Sprint 3: Flutter 生成器 MVP

**目标**: 能够生成简单 Flutter 代码

- [ ] Handlebars 模板
- [ ] 基础 Widget 生成
- [ ] Riverpod 状态管理
- [ ] 项目结构生成
- [ ] 测试生成

---

## 优先级说明

- **P0**: 核心功能，必须完成
- **P1**: 重要功能，尽快完成
- **P2**: 增强功能，有时间完成
- **P3**: 未来功能

## 标记说明

- [x] 已完成
- [ ] 待完成
- [~] 进行中
- [!] 阻塞
